"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireWildcard(require("react"));var _semanticUiReact=require("semantic-ui-react");var _isomorphicFetch=_interopRequireDefault(require("isomorphic-fetch"));var _SideMenu=_interopRequireDefault(require("./components/SideMenu"));var _View=_interopRequireDefault(require("./components/View"));var _List=_interopRequireDefault(require("./components/List"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}if(!window.Promise){window.Promise=Promise;}var Layout=function(_Component){_inherits(Layout,_Component);var _super=_createSuper(Layout);function Layout(){var _this;_classCallCheck(this,Layout);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_defineProperty(_assertThisInitialized(_this),"listLimit",10);_this.query=_this.query.bind(_assertThisInitialized(_this));_this.create=_this.create.bind(_assertThisInitialized(_this));_this.update=_this.update.bind(_assertThisInitialized(_this));_this.remove=_this.remove.bind(_assertThisInitialized(_this));_this.initCMS=_this.initCMS.bind(_assertThisInitialized(_this));_this.nextPage=_this.nextPage.bind(_assertThisInitialized(_this));_this.addNewItem=_this.addNewItem.bind(_assertThisInitialized(_this));_this.getListData=_this.getListData.bind(_assertThisInitialized(_this));_this.getViewData=_this.getViewData.bind(_assertThisInitialized(_this));_this.routeToList=_this.routeToList.bind(_assertThisInitialized(_this));_this.routeToView=_this.routeToView.bind(_assertThisInitialized(_this));_this.uploadImage=_this.uploadImage.bind(_assertThisInitialized(_this));_this.uploadFile=_this.uploadFile.bind(_assertThisInitialized(_this));_this.previewsPage=_this.previewsPage.bind(_assertThisInitialized(_this));_this.validateFields=_this.validateFields.bind(_assertThisInitialized(_this));_this.getRequestString=_this.getRequestString.bind(_assertThisInitialized(_this));_this.collectFieldsData=_this.collectFieldsData.bind(_assertThisInitialized(_this));_this.objOfFieldsToArray=_this.objOfFieldsToArray.bind(_assertThisInitialized(_this));_this.handleNewMenuClick=_this.handleNewMenuClick.bind(_assertThisInitialized(_this));_this.getCurrentViewFields=_this.getCurrentViewFields.bind(_assertThisInitialized(_this));_this.state={newMenuItemSecret:false,viewData:false,listData:false,schema:false,currentPathSchema:false,currentPathName:false,SideMenuItems:false,viewMode:false,currentItemId:false,limit:_this.listLimit,offset:0,lastPage:false,fields:false};return _this;}_createClass(Layout,[{key:"componentDidMount",value:function componentDidMount(){this.initCMS();}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(p,n){return n.currentPathSchema&&n.schema;}},{key:"getCurrentViewFields",value:function getCurrentViewFields(schema,currentRout){var array=[];var obj=_objectSpread({},schema);Object.keys(obj.fields).forEach(function(key){if(!obj.fields[key].exclude){array.push(_defineProperty({},key,obj.fields[key]));}});var h=obj.listHeader;var tb1=Array.isArray(h.id)?h.id:Object.keys(h.id).map(function(key){return h.id[key];});var tb2=Array.isArray(h.title)?h.title:Object.keys(h.title).map(function(key){return h.title[key];});this.setState({currentPathSchema:{typeName:currentRout[0],label:obj.label,resolvers:obj.resolvers,fields:array,listHeader:{id:tb1,title:tb2},uploadPath:obj.uploadPath,uploadRoot:obj.uploadRoot},fields:this.objOfFieldsToArray(obj.fields)},this.getListData);}},{key:"getViewData",value:function getViewData(id){var _this2=this;var resolver=this.state.currentPathSchema.resolvers.find.resolver;var queryArgs=this.state.currentPathSchema.resolvers.find.args;var request=this.getRequestString(this.state.fields);var queryId='';Object.keys(queryArgs).forEach(function(key){if((key==='id'||key==='_id')&&!queryId){queryId=key;}});var variables={values:_defineProperty({},queryId,id.split(':')[1]),types:_defineProperty({},queryId,queryArgs[queryId])};this.query('query',request,resolver,variables).then(function(res){return _this2.setState({viewData:res,viewMode:true,currentItemId:id});}).catch(function(err){return console.log("getViewData error: ".concat(err));});}},{key:"getRequestString",value:function getRequestString(fields){var _this3=this;var request='';fields.forEach(function(prop){if(!prop[Object.keys(prop)[0]].nestedFields){request+="".concat(Object.keys(prop)[0]," ");}else{var nestedReqFields=_this3.getRequestString(prop[Object.keys(prop)[0]].nestedFields);request+="".concat(Object.keys(prop)[0]," {").concat(nestedReqFields,"} ");}});return request;}},{key:"getListData",value:function getListData(){var _this4=this;var d=this.state.currentPathSchema;var h=this.state.currentPathSchema.listHeader;var fields=d.fields.map(function(objKey){return Object.keys(objKey)[0];});var resolver=d.resolvers.find.resolver;var _this$state=this.state,offset=_this$state.offset,limit=_this$state.limit;var data={values:{offset:offset,limit:limit},types:{offset:'Int!',limit:'Int!'}};var req="".concat(h.id.join(' ')," ").concat(h.title.join(' ')," ").concat(fields.find(function(key){return key==='_id';})?'_id':'id');this.query('query',req,resolver,data).then(function(res){if(res.errors)throw new Error(res);_this4.setState({listData:res,lastPage:res.data[resolver].length<_this4.listLimit},_this4.forceUpdate);}).catch(function(err){throw new Error("error: ".concat(err));});}},{key:"objOfFieldsToArray",value:function objOfFieldsToArray(fields){var _this5=this;var array=[];var tmpFields=_objectSpread({},fields);Object.keys(tmpFields).forEach(function(key){if(!tmpFields[key].exclude&&!tmpFields[key].nestedFields){array.push(_defineProperty({},key,tmpFields[key]));}else if(!tmpFields[key].exclude&&tmpFields[key].nestedFields){var newObj=_objectSpread({},tmpFields[key]);newObj.nestedFields=_this5.objOfFieldsToArray(tmpFields[key].nestedFields);array.push(_defineProperty({},key,newObj));}});return array;}},{key:"query",value:function query(type,request,resolver,variables){var _this6=this;return new Promise(function(resolve,reject){var graphql=_this6.props.graphql?_this6.props.graphql:_this6.props.route.graphql;var xhr=new XMLHttpRequest();xhr.responseType='json';xhr.open('POST',graphql);xhr.setRequestHeader('Content-Type','application/json');xhr.setRequestHeader('Accept','application/json');xhr.onload=function(){resolve(xhr.response);};xhr.onerror=function(err){reject(err.error);};if(!variables){xhr.send(JSON.stringify({query:"".concat(type," { ").concat(resolver," {").concat(request,"} }")}));}else{var varTypes='';var varForRequest='';Object.keys(variables.types).forEach(function(key){varTypes+="$".concat([key],": ").concat(variables.types[key]," ");varForRequest+="".concat([key],": $").concat([key]," ");});xhr.send(JSON.stringify({query:"".concat(type," ").concat(resolver,"(").concat(varTypes,") { ").concat(resolver,"(").concat(varForRequest,") {").concat(request,"}}"),variables:variables.values}));}});}},{key:"create",value:function create(data){var _this7=this;if(this.state.currentPathSchema.resolvers.create){var schema=this.state.currentPathSchema;var currentList=this.state.currentPathName;var resolver=schema.resolvers.create.resolver;var req='';schema.fields.forEach(function(prop){if(Object.keys(prop)[0]==='_id'||Object.keys(prop)[0]==='id'){req+="".concat(Object.keys(prop)[0]," ");}});if(!data){throw new Error("data wasn't provided");}else if(schema.resolvers.create){this.query('mutation',req,resolver,data).then(function(){_this7.forceUpdate();_this7.showSuccessMs();_this7.routeToList(currentList);}).catch(function(err){_this7.showErrorMs();throw new Error("create error: ".concat(err));});}}}},{key:"update",value:function update(){var _this8=this;if(this.state.currentPathSchema.resolvers.update){var schema=this.state.currentPathSchema;var resolver=schema.resolvers.update.resolver;var id=this.state.currentItemId;var req=id?id.split(':')[0]:'';var fields=this.state.fields;var data=this.collectFieldsData(fields,id,'update');if(!id&&data){data=this.collectFieldsData(fields,id,'create');this.create(data);}else if(data){if(schema.resolvers.update){this.query('mutation',req,resolver,data).then(function(res){_this8.showSuccessMs();_this8.getViewData(id);}).catch(function(err){_this8.showErrorMs();throw new Error("update error: ".concat(err));});}}}}},{key:"remove",value:function remove(e){var _this9=this;if(this.state.currentPathSchema.resolvers.remove){var id=e.target.id;var schema=this.state.currentPathSchema;var currentList=this.state.currentPathName;var resolver=schema.resolvers.remove.resolver;var req=id.split(':')[0];var data={values:{},types:{}};data.values[id.split(':')[0]]=id.split(':')[1];data.types[id.split(':')[0]]=id.split(':')[2];if(!id){throw new Error("id wasn't provided");}else if(schema.resolvers.remove){this.query('mutation',req,resolver,data).then(function(){_this9.forceUpdate();_this9.showSuccessMs();_this9.routeToList(currentList);}).catch(function(err){_this9.showErrorMs();throw new Error("remove error: ".concat(err));});}}}},{key:"initCMS",value:function initCMS(){var _this10=this;var endpoint=this.props.endpoint?this.props.endpoint:this.props.route.endpoint;(0,_isomorphicFetch.default)(endpoint,{method:'GET'}).then(function(json){return json.json();}).then(function(res){var menuItems=[];var newMenuItems=false;if(_this10.props.newMenuItems){newMenuItems=_this10.props.newMenuItems;}else if(_this10.props.route&&_this10.props.route.newMenuItems){newMenuItems=_this10.props.route.newMenuItems;}Object.keys(res).forEach(function(type){menuItems.push({label:res[type].label,typeName:type});});_this10.setState({schema:res,SideMenuItems:menuItems,newMenuItemSecret:newMenuItems&&newMenuItems[0]?newMenuItems[0].secret:false},function(){if(!_this10.state.newMenuItemSecret){var prop=_this10.state.SideMenuItems[0].typeName;_this10.getCurrentViewFields(_this10.state.schema[prop],prop);}else{_this10.forceUpdate();}});}).catch(function(err){throw new Error(err);});}},{key:"showErrorMs",value:function showErrorMs(){document.getElementById('ms-error').style.visibility='visible';document.getElementById('ms-error').style.opacity=1;setTimeout(function(){document.getElementById('ms-error').style.visibility='hidden';document.getElementById('ms-error').style.opacity=0;},3000);}},{key:"showSuccessMs",value:function showSuccessMs(){document.getElementById('ms-success').style.visibility='visible';document.getElementById('ms-success').style.opacity=1;setTimeout(function(){document.getElementById('ms-success').style.visibility='hidden';document.getElementById('ms-success').style.opacity=0;},3000);}},{key:"validateFields",value:function validateFields(data){var _this11=this;var errors=[];Object.keys(data.types).forEach(function(arg){if(/!/.test(data.types[arg])){if(typeof data.values[arg]!=='boolean'&&!data.values[arg]){errors.push(arg);_this11.showErrorMs();document.getElementById(arg).classList.add('error');document.getElementById(arg).parentNode.classList.add('error');document.getElementById(arg).placeholder='FIELD IS REQUIRED!';}else{document.getElementById(arg).classList.remove('error');document.getElementById(arg).parentNode.classList.remove('error');document.getElementById(arg).placeholder=arg;}}});return errors;}},{key:"nextPage",value:function nextPage(){var _this$state2=this.state,offset=_this$state2.offset,lastPage=_this$state2.lastPage;if(!lastPage){this.setState({offset:offset+this.listLimit},this.getListData);}}},{key:"previewsPage",value:function previewsPage(){var offset=this.state.offset;if(offset){this.setState({offset:offset-this.listLimit},this.getListData);}}},{key:"addNewItem",value:function addNewItem(){if(this.state.currentPathSchema.resolvers.create){this.setState({viewMode:true,viewData:false,currentItemId:false},this.forceUpdate);}}},{key:"routeToList",value:function routeToList(path){var _this12=this;this.setState({currentPathName:path,newMenuItemSecret:false,viewData:false,viewMode:false,listData:false,currentPathSchema:false,currentItemId:false,limit:this.listLimit,fields:false,offset:0},function(){_this12.getCurrentViewFields(_this12.state.schema[_this12.state.currentPathName],[_this12.state.currentPathName]);});}},{key:"routeToView",value:function routeToView(e){this.getViewData(e.target.id);}},{key:"collectFieldsData",value:function collectFieldsData(fields,id,action,prefix){var _this13=this;var schema=_objectSpread({},this.state.currentPathSchema);var data={values:{},types:{}};function getCurrentFieldData(id,type,prefix){var list=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var pr=prefix?"".concat(prefix,"/"):'';switch(type||type.slice(0,-1)){case'Int':if(list){var values=[];var inputs=document.getElementById("".concat(pr).concat(id)).querySelectorAll('input');inputs.forEach(function(input){values.push(Number(input.value));});return values;}return Number(document.getElementById("".concat(pr).concat(id)).value);case'Float':if(list){var _values2=[];var _inputs=document.getElementById("".concat(pr).concat(id)).querySelectorAll('input');_inputs.forEach(function(input){_values2.push(Number(input.value));});return _values2;}return Number(document.getElementById("".concat(pr).concat(id)).value);case'Boolean':if(list){var _values3=[];var _inputs2=document.getElementById("".concat(pr).concat(id)).querySelectorAll('input');_inputs2.forEach(function(input){_values3.push(input.checked);});return _values3;}return document.getElementById("".concat(pr).concat(id)).checked;case'String':if(list){var _values4=[];var _inputs3=document.getElementById("".concat(pr).concat(id)).querySelectorAll('input');_inputs3.forEach(function(input){_values4.push(input.value);});console.log(_values4);return _values4;}return document.getElementById("".concat(pr).concat(id)).value;case'file':return document.getElementById("".concat(pr).concat(id,"-p")).innerHTML;case'selection':return document.getElementById("".concat(pr).concat(id)).querySelectorAll('a[value]');default:return document.getElementById("".concat(pr).concat(id)).value;}}function getCurrentFieldMutationType(propName,schema,type,action){var response=type;if(schema.resolvers.create&&schema.resolvers.create.args[propName]&&action==='create'){response=schema.resolvers.create.args[propName];}else if(schema.resolvers.update&&schema.resolvers.update.args[propName]&&action==='update'){response=schema.resolvers.update.args[propName];}return response;}function getNestedFieldsData(nestedFields,propName){var tmpData={};nestedFields.forEach(function(field){if(!field.nestedFields){tmpData[Object.keys(field)[0]]=getCurrentFieldData(Object.keys(field)[0],field[Object.keys(field)[0]].fieldType,propName,field[Object.keys(field)[0]].list);}else{var key=Object.keys(field)[0];tmpData[key]=getNestedFieldsData(field[key].nestedFields,key);}});return tmpData;}function checkIfDisabled(field,propName){var method=false;if(action&&action==='update'&&schema.resolvers.update){method=schema.resolvers.update.args;}else if(action&&action==='create'&&schema.resolvers.create){method=schema.resolvers.create.args;}var result=method&&method[propName]?field[propName].disabled:true;if(prefix)result=false;return result;}if(!action){data={};fields.forEach(function(fieldObj){var propName=Object.keys(fieldObj)[0];var type=fieldObj[propName].fieldType;var list=fieldObj[propName].list;if(fieldObj[propName].nestedFields&&fieldObj[propName].inputControl!=='selection'){data[propName]=JSON.stringify(getNestedFieldsData(fieldObj[propName].nestedFields,propName));}else if(!checkIfDisabled(fieldObj,propName)){if(propName!=='id'&&propName!=='_id'&&propName!=='offset'&&propName!=='limit'&&fieldObj[propName].inputType!=='file'&&fieldObj[propName].inputControl!=='selection'){data[propName]=getCurrentFieldData(propName,type,prefix,list);}else if(fieldObj[propName].inputType==='file'){data.values[propName]=getCurrentFieldData(propName,'file',prefix,list);data.types[propName]='String';}else if(fieldObj[propName].inputControl==='selection'){var ref=_this13.refs.View;var selectValue=getCurrentFieldData(propName,'selection',prefix,list);var valuesData=[];selectValue.forEach(function(node){valuesData.push(ref.state["".concat(propName,"Data")][node.getAttribute('value')]);});data[propName]=JSON.stringify(valuesData);}}});}else{fields.forEach(function(fieldObj){var propName=Object.keys(fieldObj)[0];var type=fieldObj[propName].fieldType;var list=fieldObj[propName].list;if(fieldObj[propName].nestedFields&&fieldObj[propName].inputControl!=='selection'){data.values[propName]=JSON.stringify(getNestedFieldsData(fieldObj[propName].nestedFields,propName));data.types[propName]='String';}else if(!checkIfDisabled(fieldObj,propName)){if(propName!=='id'&&propName!=='_id'&&propName!=='offset'&&propName!=='limit'&&fieldObj[propName].inputType!=='file'&&fieldObj[propName].inputControl!=='selection'){data.values[propName]=getCurrentFieldData(propName,type,prefix,list);data.types[propName]=getCurrentFieldMutationType(propName,schema,type,action);}else if(fieldObj[propName].inputType==='file'){data.values[propName]=getCurrentFieldData(propName,'file',prefix,list);data.types[propName]='String';}else if(fieldObj[propName].inputControl==='selection'){var ref=_this13.refs.View;var selectValue=getCurrentFieldData(propName,'selection',prefix,list);var valuesData=[];selectValue.forEach(function(node){valuesData.push(ref.state["".concat(propName,"Data")][node.getAttribute('value')]);});data.values[propName]=JSON.stringify(valuesData);data.types[propName]='String';}else if(id){if(!data.values[id.split(':')[0]]){data.values[id.split(':')[0]]=id.split(':')[1];data.types[id.split(':')[0]]=id.split(':')[2];}else{data.values[propName]=getCurrentFieldData(propName,type,undefined,list);data.types[propName]=getCurrentFieldMutationType(propName,schema,type,action);}}}});}if(this.validateFields(data).length>0){return false;}if(action){return data;}return data;}},{key:"handleNewMenuClick",value:function handleNewMenuClick(label){this.setState({newMenuItemSecret:label,viewData:false,listData:false,currentPathSchema:false,currentPathName:false,viewMode:false,currentItemId:false,limit:this.listLimit,offset:0,lastPage:false},this.forceUpdate);}},{key:"uploadImage",value:function uploadImage(e){e.preventDefault();if(e.currentTarget.files[0]){var endpoint=this.props.endpoint?this.props.endpoint:this.props.route.endpoint;var fileFromInput=e.currentTarget.files[0];var folderPath=this.state.currentPathSchema.uploadPath?"/".concat(this.state.currentPathSchema.uploadPath):"/".concat(this.state.currentPathSchema.typeName);var massage=e.currentTarget.previousElementSibling;var fd=new FormData();fd.append('file',fileFromInput,[fileFromInput.name,folderPath]);massage.innerHTML=fileFromInput.name;(0,_isomorphicFetch.default)(endpoint,{method:'POST',body:fd}).catch(function(err){throw new Error("error: ".concat(err));});}}},{key:"uploadFile",value:function uploadFile(file){var endpoint=this.props.endpoint?this.props.endpoint:this.props.route.endpoint;var fileFromInput=file;var folderPath=this.state.currentPathSchema.uploadPath?"/".concat(this.state.currentPathSchema.uploadPath):"/".concat(this.state.currentPathSchema.typeName);var fd=new FormData();fd.append('file',fileFromInput,[fileFromInput.name,folderPath]);return(0,_isomorphicFetch.default)(endpoint,{method:'POST',body:fd});}},{key:"test",value:function test(){var _this$state3=this.state,schema=_this$state3.schema,currentPathSchema=_this$state3.currentPathSchema,fields=_this$state3.fields,viewData=_this$state3.viewData,offset=_this$state3.offset,lastPage=_this$state3.lastPage,listData=_this$state3.listData,SideMenuItems=_this$state3.SideMenuItems,viewMode=_this$state3.viewMode,currentItemId=_this$state3.currentItemId,newMenuItemSecret=_this$state3.newMenuItemSecret;var routeToList=this.routeToList,routeToView=this.routeToView,routeToAdd=this.routeToAdd,addNewItem=this.addNewItem,uploadImage=this.uploadImage,getRequestString=this.getRequestString,nextPage=this.nextPage,previewsPage=this.previewsPage,query=this.query,update=this.update,remove=this.remove,handleNewMenuClick=this.handleNewMenuClick,collectFieldsData=this.collectFieldsData;var newMenuItems=false;if(this.props.newMenuItems){newMenuItems=this.props.newMenuItems;}else if(this.props.route&&this.props.route.newMenuItems){newMenuItems=this.props.route.newMenuItems;}var resolverForList=false;var NewMenuView=false;if(newMenuItemSecret&&newMenuItems){NewMenuView=newMenuItems.find(function(item){return item.secret===newMenuItemSecret;}).view.component;}else{resolverForList=currentPathSchema.resolvers.find.resolver;}console.log(JSON.stringify({state:this.state,data:!viewData?false:viewData.data[resolverForList][0]?viewData.data[resolverForList][0]:viewData.data[resolverForList],listD:listData.data[resolverForList]},null,2));}},{key:"render",value:function render(){var Column=_semanticUiReact.Grid.Column;var _this$state4=this.state,schema=_this$state4.schema,currentPathSchema=_this$state4.currentPathSchema,fields=_this$state4.fields,viewData=_this$state4.viewData,offset=_this$state4.offset,lastPage=_this$state4.lastPage,listData=_this$state4.listData,SideMenuItems=_this$state4.SideMenuItems,viewMode=_this$state4.viewMode,currentItemId=_this$state4.currentItemId,newMenuItemSecret=_this$state4.newMenuItemSecret;var routeToList=this.routeToList,routeToView=this.routeToView,routeToAdd=this.routeToAdd,addNewItem=this.addNewItem,uploadImage=this.uploadImage,uploadFile=this.uploadFile,getRequestString=this.getRequestString,nextPage=this.nextPage,previewsPage=this.previewsPage,query=this.query,update=this.update,remove=this.remove,handleNewMenuClick=this.handleNewMenuClick,collectFieldsData=this.collectFieldsData;var showGithub=this.props.showGithub;var newMenuItems=false;if(this.props.newMenuItems){newMenuItems=this.props.newMenuItems;}else if(this.props.route&&this.props.route.newMenuItems){newMenuItems=this.props.route.newMenuItems;}if(!schema){return _react.default.createElement(_semanticUiReact.Segment,{className:"loading-block"},_react.default.createElement("div",{className:"ui active dimmer"},_react.default.createElement(_semanticUiReact.Loader,{content:"Loading"})));}var resolverForList=false;var NewMenuView=false;if(newMenuItemSecret&&newMenuItems){NewMenuView=newMenuItems.find(function(item){return item.secret===newMenuItemSecret;}).view.component;}else{resolverForList=currentPathSchema.resolvers.find.resolver;}return _react.default.createElement(_semanticUiReact.Grid,{className:"graphql-cms"},_react.default.createElement(Column,{computer:3,mobile:16},_react.default.createElement(_SideMenu.default,{newMenuItems:newMenuItems,items:SideMenuItems,handleNewMenuClick:handleNewMenuClick,routeToList:routeToList,showGithub:showGithub})),_react.default.createElement(_semanticUiReact.Message,{color:"green",id:"ms-success"},"Success!"),_react.default.createElement(_semanticUiReact.Message,{color:"red",id:"ms-error"},"Error!"),_react.default.createElement(Column,{computer:13,mobile:16},viewMode?!viewData&&currentItemId?_react.default.createElement(_semanticUiReact.Segment,{className:"loading-block"},_react.default.createElement("div",{className:"ui active dimmer"},_react.default.createElement(_semanticUiReact.Loader,{content:"Loading"}))):_react.default.createElement(_View.default,{ref:"View",query:query,data:!viewData?false:viewData.data[resolverForList][0]?viewData.data[resolverForList][0]:viewData.data[resolverForList],dataErrors:!viewData.errors?[]:viewData.errors,fields:fields,update:update,remove:remove,currentItemId:currentItemId,addNewItem:addNewItem,routeToAdd:routeToAdd,uploadImage:uploadImage,uploadFile:uploadFile,collectFieldsData:collectFieldsData,getRequestString:getRequestString,schema:currentPathSchema}):!listData?!newMenuItemSecret?_react.default.createElement(_semanticUiReact.Segment,{className:"loading-block"},_react.default.createElement("div",{className:"ui active dimmer"},_react.default.createElement(_semanticUiReact.Loader,{content:"Loading"}))):_react.default.createElement(_semanticUiReact.Segment,{color:"black",className:"View"},_react.default.createElement(NewMenuView,null)):_react.default.createElement(_List.default,{remove:remove,offset:offset,lastPage:lastPage,nextPage:nextPage,previewsPage:previewsPage,addNewItem:addNewItem,routeToView:routeToView,data:listData.data[resolverForList],schema:currentPathSchema})));}}]);return Layout;}(_react.Component);var _default=Layout;exports.default=_default;